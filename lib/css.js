'use strict';

var existy = require('swsutils/src/existy');
var attr = require('./attr.js');
var isPcWidth = require('./isPcWidth.js');

module.exports = function (el) {
  var size = parseInt(attr(el, 'data-sws-nav-drawer-size', 50), 10);
  var bgColor = attr(el, 'data-sws-nav-drawer-bg-color', '#ffc966');
  var fgColor = attr(el, 'data-sws-nav-drawer-fg-color', '#ffffff');
  var image = attr(el, 'data-sws-nav-drawer-src', null);
  var zIndex = parseInt(attr(el, 'data-sws-nav-drawer-z-index', 1000), 10);
  var isLeft = attr(el, 'data-sws-nav-drawer-position', 'left') === 'left';

  var lineColor = fgColor.replace(/#/g, '%23');
  var bgImage = existy(image) ? 'url(' + image + ')' : 'url("data:image/svg+xml;charset=utf8, %3Csvg xmlns=%22http://www.w3.org/2000/svg%22 x=%220px%22 y=%220px%22 width=%2240px%22 height=%2240px%22 viewBox=%220 0 40 40%22%3E%3Crect fill=%22' + lineColor + '%22 x=%225%22 y=%2217%22 width=%2230%22 height=%224%22/%3E%3Crect fill=%22' + lineColor + '%22 x=%225%22 y=%227%22 width=%2230%22 height=%224%22/%3E%3Crect fill=%22' + lineColor + '%22 x=%225%22 y=%2227%22 width=%2230%22 height=%224%22/%3E%3C/svg%3E")';

  return '\n#sws-nav-drawer-handle {\n  overflow: hidden;\n  display: block;\n  position: relative;\n  width: ' + size + 'px;\n  height: ' + size + 'px;\n  color: ' + fgColor + ';\n  background-color: ' + bgColor + ';\n  cursor: pointer;\n}\n#sws-nav-drawer-image {\n  display: block;\n  position: relative;\n  width: ' + size + 'px;\n  height: ' + size + 'px;\n  background: transparent ' + bgImage + ' no-repeat 50% 50%;\n  background-size: 100% 100%;\n}\n\n#sws-nav-drawer {\n  overflow-y: scroll;\n  position: fixed;\n  ' + (isLeft ? 'left: -80vw' : 'right: -80vw') + ';\n  top: 0;\n  z-index: ' + (zIndex + 1) + ';\n  width: 80vw;\n  max-width: 320px;\n  height: 100%;\n  background-color: #eee;\n  box-shadow: 0 0 0 rgba(0, 0, 0, 0);\n  transition: ' + (isLeft ? 'left' : 'right') + ' .3s ease-out 0s, box-shadow .3s ease-out 0s;\n}\n#sws-nav-drawer-cover {\n  overflow: hidden;\n  position: fixed;\n  left: 0;\n  top: 0;\n  z-index: -1;\n  width: 100%;\n  height: 120%;\n  background-color: rgba(0, 0, 0, .7);\n  opacity: 0;\n  transform: scale(0);\n  transition: opacity .3s ease-out 0s, transform 0s linear .3s;\n}\n#sws-nav-drawer-close {\n  display: block;\n  position: absolute;\n  ' + (isLeft ? 'left' : 'right') + ': -' + size + 'px;\n  top: 5px;\n  width: ' + size + 'px;\n  height: ' + size + 'px;\n  background: transparent url("data:image/svg+xml;charset=utf8,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 x=%220px%22 y=%220px%22 width=%2240px%22 height=%2240px%22 viewBox=%220 0 40 40%22%3E%3Cpolygon fill=%22%23ffffff%22 points=%2232.021,10.808 29.192,7.979 20,17.171 10.808,7.979 7.979,10.808 17.171,20 7.979,29.193 10.808,32.021 20,22.828 29.192,32.021 32.021,29.193 22.828,20 %22/%3E%3C/svg%3E") no-repeat 50% 50%;\n  background-size: 100% 100%;\n  cursor: pointer;\n  transition: ' + (isLeft ? 'left' : 'right') + ' .3s ease-out 0s;\n}\n.sws-nav-drawer-is-active {\n  overflow: hidden;\n}\n.sws-nav-drawer-is-active #sws-nav-drawer {\n  ' + (isLeft ? 'left: 0' : 'right: 0') + ';\n  box-shadow: 2px 0 10px rgba(0, 0, 0, .3);\n}\n.sws-nav-drawer-is-active #sws-nav-drawer-cover {\n  opacity: 1;\n  z-index: ' + zIndex + ';\n  transition: ' + (isLeft ? 'left' : 'right') + ' .3s ease-out 0s;\n  transform: scale(1);\n  transition: opacity .3s ease-out 0s, transform 0s linear 0s, z-index 0s linear .3s;\n}\n.sws-nav-drawer-is-active #sws-nav-drawer-close {\n  ' + (isLeft ? 'left' : 'right') + ': ' + (isPcWidth(640) ? '320px' : '80vw') + ';\n  transition: ' + (isLeft ? 'left' : 'right') + ' .6s ease-out .3s;\n}\n';
};